---
title: What is the alternative way to retrieve the inserted id using sqlalchemy flush() function?
authors:
- smart_coder
tags:
- python
- knowledge
thumbnail: images/python.png
created_at: 2023-03-11 00:00:00
updated_at: 2023-03-11 00:00:00
tldr: The flush() method in SQLAlchemy writes changes to the database but does not return the inserted ID, while the method execute() should be used to retrieve the ID of the last inserted row.
---

**Contents**

[TOC]

Section 1: Introduction

SQLAlchemy is a popular Object-Relational Mapping (ORM) tool for Python that provides a high-level interface between Python code and relational databases. One of the main advantages of using SQLAlchemy is that it eliminates the need to write raw SQL queries.

In this tutorial, we will discuss SQLAlchemy's flush() function and how to get the inserted ID after a database insert operation.

Section 2: The flush() function

The flush() function is a method provided by SQLAlchemy that writes any pending changes to the database. SQLAlchemyâ€™s ORM tracks any changes made to objects in the session and queues them for execution. The flush() function executes all the pending changes (INSERT, UPDATE, and DELETE) in the order that they were queued.

Here is an example of how to use the flush() function in SQLAlchemy:

```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

# create engine
engine = create_engine('postgresql://myuser:mypassword@localhost/mydatabase')

# create session
Session = sessionmaker(bind=engine)
session = Session()

# create a new user object
new_user = User(name='Johnny', age=25)

# add the new user to the session
session.add(new_user)

# flush the session to write the changes to the database
session.flush()

# commit the transaction to make the changes permanent
session.commit()
```

In the example above, we create a new user object and add it to the session. The flush() function writes the new object to the database before we commit the transaction.

Section 3: Getting the inserted ID

After inserting a new record into a database table, it is often necessary to obtain the ID that was automatically generated by the database. In PostgreSQL, this is usually done using the RETURNING clause. In SQLAlchemy, we can use the `insert()` function to achieve the same effect.

Here is an example of how to get the inserted ID after an insert operation using SQLAlchemy:

```python
from sqlalchemy import create_engine, insert
from sqlalchemy.orm import sessionmaker

# create engine
engine = create_engine('postgresql://myuser:mypassword@localhost/mydatabase')

# create session
Session = sessionmaker(bind=engine)
session = Session()

# create insert statement
new_user = {'name': 'Johnny', 'age': 25}
stmt = insert(User).values(new_user)

# execute the insert statement and get the inserted ID
result = session.execute(stmt)
inserted_id = result.inserted_primary_key[0]
```

In the example above, we create an insert statement using the `insert()` function and execute it using the session. We can then get the inserted ID using the `inserted_primary_key` attribute of the `result` object.

Section 4: Conclusion

In conclusion, the flush() function provided by SQLAlchemy writes any pending changes to the database and is useful for ensuring that changes are written to the database before the transaction is committed. To obtain the inserted ID after an insert operation, we can use the `insert()` function and `inserted_primary_key` attribute of the `result` object.
